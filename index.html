<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dolní Lhota Run - Firebase modular SDK</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; background:#f0f4ff; color:#222; transition: background 0.3s, color 0.3s;}
  body.dark { background:#121417; color:#eee; }
  header { background: linear-gradient(90deg, #2e5dbd, #5786ff); color:white; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
  nav { background:white; display:flex; justify-content:center; gap:10px; padding:10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  body.dark nav { background:#20232a; box-shadow: 0 2px 5px rgba(255,255,255,0.1); }
  nav button { background:#5786ff; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; font-weight:600; transition: background-color 0.3s;}
  body.dark nav button { background:#7ea1ff; color:#20232a; }
  nav button:hover, nav button.active { background:#2e5dbd; }
  body.dark nav button:hover, body.dark nav button.active { background:#436aff; color:white; }
  main { max-width:900px; margin:20px auto; padding:0 20px; }
  section { display:none; }
  section.active { display:block; }
  h2 { color:#2e5dbd; transition: color 0.3s;}
  body.dark h2 { color:#7ea1ff; }
  label { display:block; margin-top:15px; font-weight:600; }
  input[type=number], input[type=email], input[type=password] { width:100%; max-width:300px; padding:8px; margin-top:5px; border:1px solid #bbb; border-radius:4px; font-size:1rem; background:white; color:black; transition: background 0.3s, color 0.3s; }
  body.dark input[type=number], body.dark input[type=email], body.dark input[type=password] { background:#2a2c33; color:#eee; border-color:#555; }
  button { margin-top:20px; background:#2e5dbd; color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-size:1rem; transition: background 0.3s;}
  button:hover { background:#436aff; }
  body.dark button { background:#436aff; }
  body.dark button:hover { background:#2e5dbd; }
  ul { list-style:none; padding-left:0; }
  ul li { margin-bottom:8px; }
</style>
</head>
<body>

<header>
  <h1>🏃 Dolní Lhota Run</h1>
  <button id="btnToggleTheme" title="Přepnout tmavý režim">🌙</button>
  <button id="btnLogout" style="display:none;">Odhlásit</button>
</header>

<nav>
  <button id="btnDashboard" class="active">Hlavní stránka</button>
  <button id="btnMyRuns" style="display:none;">Moje běhy</button>
  <button id="btnLogin">Přihlásit se</button>
</nav>

<main>
  <section id="dashboard" class="active">
    <h2>Vítej v běžecké výzvě Dolní Lhoty!</h2>
    <p>Tady budeš sledovat své výsledky a statistiky.</p>
  </section>

  <section id="loginSection" style="display:none;">
    <h2>Přihlášení</h2>
    <label for="loginEmail">Email</label>
    <input type="email" id="loginEmail" placeholder="email@example.com" />
    <label for="loginPassword">Heslo</label>
    <input type="password" id="loginPassword" placeholder="heslo" />
    <button id="btnLoginSubmit">Přihlásit</button>
  </section>

  <section id="myRunsSection" style="display:none;">
    <h2>Moje běhy</h2>
    <label for="runKm">Kilometry (km)</label>
    <input type="number" id="runKm" step="0.01" min="0" />
    <label for="runMin">Čas (minuty)</label>
    <input type="number" id="runMin" min="0" />
    <button id="btnAddRun">Přidat běh</button>
    <ul id="runsList"></ul>
  </section>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, orderBy, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "TVŮJ_API_KEY",
    authDomain: "TVŮJ_AUTH_DOMAIN",
    projectId: "TVŮJ_PROJECT_ID",
    storageBucket: "TVŮJ_STORAGE_BUCKET",
    messagingSenderId: "TVŮJ_MESSAGING_SENDER_ID",
    appId: "TVŮJ_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const btnToggleTheme = document.getElementById('btnToggleTheme');
  const btnLogout = document.getElementById('btnLogout');
  const btnLogin = document.getElementById('btnLogin');
  const btnDashboard = document.getElementById('btnDashboard');
  const btnMyRuns = document.getElementById('btnMyRuns');
  const btnLoginSubmit = document.getElementById('btnLoginSubmit');
  const btnAddRun = document.getElementById('btnAddRun');

  const dashboard = document.getElementById('dashboard');
  const loginSection = document.getElementById('loginSection');
  const myRunsSection = document.getElementById('myRunsSection');
  const runsList = document.getElementById('runsList');

  function showSection(section) {
    dashboard.style.display = 'none';
    loginSection.style.display = 'none';
    myRunsSection.style.display = 'none';
    section.style.display = 'block';
  }

  btnDashboard.onclick = () => {
    showSection(dashboard);
  };

  btnLogin.onclick = () => {
    showSection(loginSection);
  };

  btnLogout.onclick = () => {
    signOut(auth);
  };

  btnLoginSubmit.onclick = async () => {
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    if (!email || !password) {
      alert('Vyplňte email i heslo.');
      return;
    }
    try {
      await signInWithEmailAndPassword(auth, email, password);
      alert('Přihlášení úspěšné!');
    } catch (error) {
      alert('Chyba přihlášení: ' + error.message);
    }
  };

  btnAddRun.onclick = async () => {
    const km = parseFloat(document.getElementById('runKm').value);
    const min = parseInt(document.getElementById('runMin').value);
    if (!km || !min) {
      alert('Vyplňte km i čas.');
      return;
    }
    const pace = min / km;
    const user = auth.currentUser;
    if (!user) {
      alert('Nejste přihlášen.');
      return;
    }
    try {
      await addDoc(collection(db, 'runs'), {
        userId: user.uid,
        km,
        min,
        pace,
        timestamp: serverTimestamp()
      });
      alert('Běh přidán.');
      document.getElementById('runKm').value = '';
      document.getElementById('runMin').value = '';
      loadRuns(user.uid);
    } catch (error) {
      alert('Chyba při přidávání běhu: ' + error.message);
    }
  };

  async function loadRuns(uid) {
    runsList.innerHTML = 'Načítám...';
    try {
      const q = query(collection(db, 'runs'), where('userId
