<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Doln√≠ Lhota Run</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: sans-serif; background: #f8f8f8; color: #222; padding: 20px; max-width: 400px; margin: auto; transition: margin-left 0.3s; }
    h1, h2 { text-align: center; color: #ff6600; }
    input, button, select { font-size: 1.2em; padding: 12px; margin: 10px 0; width: 100%; border-radius: 8px; border: 1px solid #aaa; }
    button { background: #ff6600; color: #fff; font-weight: bold; cursor: pointer; }
    .hidden { display: none; }
    #sidebar { height: 100%; width: 0; position: fixed; z-index: 100; top: 0; left: 0; background: #f0f0f0; overflow-x: auto; transition: 0.3s; padding-top: 20px; display: flex; flex-direction: column; }
    #sidebar a { padding: 8px 8px 8px 32px; text-decoration: none; font-size: 1.2em; color: #333; display: block; transition: 0.3s; }
    #sidebar a:hover { background: #ddd; }
    #hamburger { position: fixed; top: 15px; left: 15px; font-size: 2.2em; cursor: pointer; z-index: 101; }
    .card { background: #fff; border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 10px; }
  </style>
</head>
<body>
  <div id="hamburger" onclick="toggleSidebar()">‚ò∞</div>
  <div id="sidebar">
    <div id="odhlasBtn" onclick="odhlasit()">üö™</div>
    <a href="#" onclick="zobrazSekci('dashboard')">Dashboard</a>
    <a href="#" onclick="zobrazSekci('mojeBehy')">Moje bƒõhy</a>
    <a href="#" onclick="zobrazSekci('tymMain')">T√Ωm</a>
  </div>

  <h1>Doln√≠ Lhota Run</h1>

  <div id="loginSection">
    <h2>P≈ôihl√°≈°en√≠</h2>
    <input type="email" id="emailLogin" placeholder="Email">
    <input type="password" id="passwordLogin" placeholder="Heslo">
    <button onclick="prihlasit()">P≈ôihl√°sit</button>
    <h2>Registrace</h2>
    <input type="email" id="emailReg" placeholder="Email">
    <input type="password" id="passwordReg" placeholder="Heslo">
    <button onclick="registruj()">Registrovat</button>
  </div>

  <div id="dashboardSection" class="hidden">
    <h2>Zadat nov√Ω bƒõh</h2>
    <input type="number" id="km" placeholder="Kolik km?">
    <input type="number" id="cas" placeholder="ƒåas v minut√°ch">
    <button onclick="pridatBeh()">P≈ôidat bƒõh</button>

    <h2>Po≈ôad√≠ u≈æivatel≈Ø</h2>
    <div id="stavUzivatelu"></div>
  </div>

  <div id="mojeBehySection" class="hidden">
    <h2>Moje bƒõhy</h2>
    <div id="mojeBehy"></div>
  </div>

  <div id="tymMainSection" class="hidden">
    <h2>T√Ωm</h2>
    <button onclick="zobrazSekci('tymVytvor')">Vytvo≈ôit t√Ωm</button>
    <button onclick="zobrazSekci('tymPridat')">P≈ôidat do t√Ωmu</button>
  </div>

  <div id="tymVytvorSection" class="hidden">
    <h2>Vytvo≈ôit t√Ωm</h2>
    <input type="text" id="nazevTymu" placeholder="N√°zev t√Ωmu">
    <button onclick="vytvorTym()">Vytvo≈ôit</button>
  </div>

  <div id="tymPridatSection" class="hidden">
    <h2>P≈ôidat do t√Ωmu</h2>
    <select id="teamDropdown"></select>
    <button onclick="joinSelectedTeam()">P≈ôidat do t√Ωmu</button>
  </div>

  <script>
    const firebaseConfig = { /* va≈°e firebaseConfig */ };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let aktualniTym = null;
    let nick = "";

    function toggleSidebar() {
      const sb = document.getElementById("sidebar");
      if (sb.style.width === "250px") { sb.style.width = "0"; document.body.style.marginLeft = "0"; }
      else { sb.style.width = "250px"; document.body.style.marginLeft = "250px"; }
    }

    function prihlasit() {
      const email = document.getElementById('emailLogin').value;
      const password = document.getElementById('passwordLogin').value;
      auth.signInWithEmailAndPassword(email, password).catch(err => alert(err.message));
    }
    function registruj() {
      const email = document.getElementById('emailReg').value;
      const password = document.getElementById('passwordReg').value;
      auth.createUserWithEmailAndPassword(email, password).catch(err => alert(err.message));
    }
    function odhlasit() { auth.signOut(); }

    function zobrazSekci(sekce) {
      ['dashboard','mojeBehy','tymMain','tymVytvor','tymPridat'].forEach(s => {
        document.getElementById(s + 'Section').classList.add('hidden');
      });
      document.getElementById(sekce + 'Section').classList.remove('hidden');
      toggleSidebar();
      if (sekce === 'tymPridat') zobrazTymy();
      if (sekce === 'mojeBehy') zobrazMojeBehy();
    }

    function vytvorTym() {
      const nazev = document.getElementById('nazevTymu').value.trim();
      if (!nazev) return alert('Zadej n√°zev t√Ωmu.');
      db.collection("tymy").add({ nazev }).then(() => {
        alert('T√Ωm vytvo≈ôen'); zobrazSekci('tymMain');
      });
    }

    function zobrazTymy() {
      const dropdown = document.getElementById('teamDropdown');
      dropdown.innerHTML = '<option value="">Vyber t√Ωm</option>';
      db.collection("tymy").onSnapshot(snapshot => {
        snapshot.forEach(doc => {
          const t = doc.data();
          const opt = document.createElement('option');
          opt.value = t.nazev;
          opt.text = t.nazev;
          dropdown.appendChild(opt);
        });
      });
    }

    function joinSelectedTeam() {
      const val = document.getElementById('teamDropdown').value;
      if (!val) return alert('Vyber t√Ωm, do kter√©ho se chce≈° p≈ôidat');
      pripojSe(val);
    }

    function pripojSe(nazevTymu) {
      db.collection("uzivatele").doc(nick).set({ tym: nazevTymu }).then(() => {
        aktualniTym = nazevTymu;
        alert('P≈ôidal ses do t√Ωmu: ' + nazevTymu);
        zobrazSekci('tymMain');
      });
    }

    function pridatBeh() {
      const km = parseFloat(document.getElementById('km').value);
      const cas = parseFloat(document.getElementById('cas').value);
      if (!km || !cas) return alert("Zadej spr√°vnƒõ km a ƒças");
      const tempo = (cas / km).toFixed(2);
      const datum = new Date().toLocaleDateString();
      db.collection("behy").add({ jmeno: nick, km, cas, tempo, datum }).then(() => {
        document.getElementById('km').value = '';
        document.getElementById('cas').value = '';
        nactiBehy(); zobrazMojeBehy();
      });
    }

    function zobrazMojeBehy() {
      db.collection("behy").where("jmeno","==",nick).onSnapshot(snapshot => {
        let html = '';
        snapshot.forEach(doc => {
          const z = doc.data();
          html += `<div class='card'>${z.datum}: ${z.km} km za ${z.cas} min (${z.tempo} min/km)</div>`;
        });
        document.getElementById('mojeBehy').innerHTML = html;
      });
    }

    function nactiBehy() {
      db.collection("behy").onSnapshot(snapshot => {
        const soucty = {};
        snapshot.forEach(doc => {
          const z = doc.data();
          soucty[z.jmeno] = soucty[z.jmeno] || { km: 0, cas: 0, tempo: 0, pocet: 0 };
          soucty[z.jmeno].km += z.km;
          soucty[z.jmeno].cas += z.cas;
          soucty[z.jmeno].tempo += parseFloat(z.tempo) || 0;
          soucty[z.jmeno].pocet++;
        });
        let i = 1;
        document.getElementById('stavUzivatelu').innerHTML = Object.entries(soucty)
          .sort((a,b)=>b[1].km - a[1].km)
          .map(([j, data]) => `<div class='card'>${i++}. <strong>${j}</strong>: ${data.km} km, ${data.cas} min, ${(data.tempo/data.pocet).toFixed(2)} min/km</div>`)
          .join('');
      });
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        nick = user.email.split('@')[0];
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('dashboardSection').classList.remove('hidden');
        zobrazSekci('dashboard');
      } else {
        document.getElementById('loginSection').classList.remove('hidden');
        ['dashboard','mojeBehy','tymMain','tymVytvor','tymPridat'].forEach(s => document.getElementById(s+'Section').classList.add('hidden'));
      }
    });
  </script>
</body>
</html>
